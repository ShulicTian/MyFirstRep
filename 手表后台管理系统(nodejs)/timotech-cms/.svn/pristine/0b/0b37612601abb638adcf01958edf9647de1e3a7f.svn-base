<div data-options="region:'north',border:false" class="header">
	<%= config.site_title %>
	<a href="/signout">退出登录</a>
</div>
<div data-options="region:'south',border:false,split:true" style="height:10px;"></div>
<div data-options="region:'west',title:'导航菜单',split:true" style="width:180px;">
	<div id="RightTree" style=" background-color:#fff; overflow: hidden;">
		<ul id="accordion" class="accordion">
			<li>
				<div class="link"><i class="fa fa-tachometer"></i>设备管理<i class="fa fa-angle-double-down"></i></div>
				<ul class="submenu">
					<% if (current_user.isAdmin&&current_user.organID==1) { %>
					<li><a href="javascript:void(0)" class="attr-tab" src="/device/log">日志查询</a></li>
					<li><a href="javascript:void(0)" class="attr-tab" src="/device/watch">设备测试</a></li>
					<% } %>
					<li><a href="javascript:void(0)" class="attr-tab" src="/device/device">设备管理</a></li>
				</ul>
			</li>
			<li>
				<div class="link"><i class="fa fa-tachometer"></i>资源管理<i class="fa fa-angle-double-down"></i></div>
			</li>
			<li>
				<div class="link"><i class="fa fa-cog"></i>系统管理<i class="fa fa-angle-double-down"></i></div>
				<ul class="submenu">
					<% if (current_user.isAdmin) { %>
					<li><a href="javascript:void(0)" class="attr-tab" src="/admin/organ">组织管理</a></li>
					<li><a href="javascript:void(0)" class="attr-tab" src="/admin/user">用户管理</a></li>
					<% } %>
					<li><a href="javascript:void(0)" class="attr-tab" src="/admin/updatepswd">修改密码</a></li>
				</ul>
			</li>

		</ul>
	</div>
</div>
<div id="mainPanle" region="center" border="false">
	<div id="tabs" class="easyui-tabs" fit="true" border="false">
		<div title="主页">
			<div id="main-container">
				<h1 style="padding:15px;">欢迎来到儿童手表后台</h1>
			</div>
		</div>
	</div>
</div>
<div id="mm" class="easyui-menu cs-tab-menu">
	<div id="mm-tabupdate">刷新</div>
	<div class="menu-sep"></div>
	<div id="mm-tabclose">关闭</div>
	<div id="mm-tabcloseother">关闭其他</div>
	<div id="mm-tabcloseall">关闭全部</div>
</div>
<script type="text/javascript">
	$(function () {
		tabCloseEven();

		var attrTab = $('.attr-tab');
		var container = $("#main-container");
		attrTab.on("click", function () {
			var $this = $(this);
			var title = $this.text();
			var href = $this.attr('src');
			addTab(title, href);
		});
	});

	function addTab(title, url) {
		if ($('#tabs').tabs('exists', title)) {
			$('#tabs').tabs('select', title);//选中并刷新
			var currTab = $('#tabs').tabs('getSelected');
			var url = $(currTab.panel('options').content).attr('src');
			if (url != undefined && currTab.panel('options').title != '主页') {
				$('#tabs').tabs('update', {
					tab: currTab,
					options: {
						content: createFrame(url)
					}
				});
			}
		} else {
			var content = createFrame(url);
			$('#tabs').tabs('add', {
				title: title,
				content: content,
				closable: true
			});
		}
		tabClose();
	}

	function createFrame(url) {
		return '<iframe id="ifrm" scrolling="no" frameborder="0" src="' + url + '" style="width:100%;height:100%;overflow-y : hidden;"></iframe>';
	}

	function tabClose() {
		/*双击关闭TAB选项卡*/
		$(".tabs-inner").dblclick(function () {
			var subtitle = $(this).children(".tabs-closable").text();
			$('#tabs').tabs('close', subtitle);
		});
		/*为选项卡绑定右键*/
		$(".tabs-inner").bind('contextmenu', function (e) {
			$('#mm').menu('show', {
				left: e.pageX,
				top: e.pageY
			});

			var subtitle = $(this).children(".tabs-closable").text();

			$('#mm').data("currtab", subtitle);
			$('#tabs').tabs('select', subtitle);
			return false;
		});
	}

	//绑定右键菜单事件
	function tabCloseEven() {
		//刷新
		$('#mm-tabupdate').click(function () {
			var currTab = $('#tabs').tabs('getSelected');
			var url = $(currTab.panel('options').content).attr('src');
			if (url != undefined && currTab.panel('options').title != '主页') {
				$('#tabs').tabs('update', {
					tab: currTab,
					options: {
						content: createFrame(url)
					}
				})
			}
		});
		//关闭当前
		$('#mm-tabclose').click(function () {
			var currtab_title = $('#mm').data("currtab");
			$('#tabs').tabs('close', currtab_title);
		});
		//全部关闭
		$('#mm-tabcloseall').click(function () {
			$('.tabs-inner span').each(function (i, n) {
				var t = $(n).text();
				if (t != '主页') {
					$('#tabs').tabs('close', t);
				}
			});
		});
		//关闭除当前之外的TAB
		$('#mm-tabcloseother').click(function () {
			var prevall = $('.tabs-selected').prevAll();
			var nextall = $('.tabs-selected').nextAll();
			if (prevall.length > 0) {
				prevall.each(function (i, n) {
					var t = $('a:eq(0) span', $(n)).text();
					if (t != '主页') {
						$('#tabs').tabs('close', t);
					}
				});
			}
			if (nextall.length > 0) {
				nextall.each(function (i, n) {
					var t = $('a:eq(0) span', $(n)).text();
					if (t != '主页') {
						$('#tabs').tabs('close', t);
					}
				});
			}
			return false;
		});
		//关闭当前右侧的TAB
		$('#mm-tabcloseright').click(function () {
			var nextall = $('.tabs-selected').nextAll();
			if (nextall.length == 0) {
				//msgShow('系统提示','后边没有啦~~','error');
				alert('后边没有啦~~');
				return false;
			}
			nextall.each(function (i, n) {
				var t = $('a:eq(0) span', $(n)).text();
				$('#tabs').tabs('close', t);
			});
			return false;
		});
		//关闭当前左侧的TAB
		$('#mm-tabcloseleft').click(function () {
			var prevall = $('.tabs-selected').prevAll();
			if (prevall.length == 0) {
				alert('到头了，前边没有啦~~');
				return false;
			}
			prevall.each(function (i, n) {
				var t = $('a:eq(0) span', $(n)).text();
				$('#tabs').tabs('close', t);
			});
			return false;
		});

		//退出
		$("#mm-exit").click(function () {
			$('#mm').menu('hide');
		});
	}
</script>