<div class="easyui-layout" fit="true">
	<div data-options="region:'center',border:false">
		<div id="toolbar2" class="datagrid-toolbar" style="height: 26px; padding: 2px; ">
			<% if (current_user.isAdmin) { %>
			<div style="float: left">
				<a href="javascript:void(0)" class="easyui-linkbutton opbtn" iconCls="icon-add" plain="true" onclick="insert()">添加</a>
			</div>
			<div class="datagrid-btn-separator"></div>
			<div style="float: left">
				<a href="javascript:void(0)" class="easyui-linkbutton opbtn" iconCls="icon-edit" disabled="disabled" plain="true" onclick="edit()">编辑</a>
			</div>
			<div class="datagrid-btn-separator"></div>
			<div style="float: left">
				<a href="javascript:void(0)" class="easyui-linkbutton opbtn" iconCls="icon-remove" disabled="disabled" plain="true" onclick="deleteRow()">删除</a>
			</div>
			<% } %>
		</div>
		<table id="dgUpdate" nowrap="false" rownumbers="true" singleSelect="true">
			<thead>
			<tr>
				<input type="hidden" name="id"/>
				<th field="version" width="100px">版本</th>
				<th field="wVersion" width="100px">Watch版本</th>
				<th field="modifyDesc" width="300px">ModifyDesc</th>
				<th field="updateDesc" width="300px">UpdateDesc</th>
				<th field="updatePreTip" width="300px">UpdatePreTip</th>
				<th field="updatingTip" width="250px">UpdatingTip</th>
				<th field="failureTip" width="250px">FailureTip</th>
			</tr>
			</thead>
		</table>
	</div>
</div>
<div id="dlg" class="easyui-dialog" style="width: 800px; height: 500px;margin:auto;"
     closed="true" buttons="#dlg-buttons">
	<!--<form id="fm" method="post">
		<div style="margin-top:10px;margin-left:70px;">
			<label style="margin:0px;">版本&nbsp;&nbsp;&nbsp;</label><input name="version" class="easyui-textbox tbinput2" required="true" style="width:490px"/>
		</div>
		<div style="margin-top:20px;margin-left:70px;float: left;">
			<label>ModifyDesc&nbsp;&nbsp;&nbsp;</label><br><input name="modifyDesc" data-options="multiline:true" class="easyui-textbox tbinput3" required="true" style="height:100px;"/>
		</div>
		<div style="margin-top:20px;margin-right:70px;float: right;">
			<label>UpdateDesc&nbsp;&nbsp;&nbsp;</label><br><input name="updateDesc" data-options="multiline:true" class="easyui-textbox tbinput6" required="true" style="height:100px;"/>
		</div>

		<div style="margin-top:10px;margin-left:70px;float: left;">
			<label>UpdatePreTip&nbsp;&nbsp;&nbsp;</label><br><input name="updatePreTip" data-options="multiline:true" class="easyui-textbox tbinput5" required="true" style="height:100px;"/>
		</div>
		<div style="margin-top:10px;margin-right:70px;float: right;">
			<label>UpdatingTip&nbsp;&nbsp;&nbsp;</label><br><input name="updatingTip" data-options="multiline:true" class="easyui-textbox tbinput4" required="true" style="height:100px;"/>
		</div>

		<div style="margin-top:10px;margin-left:70px;float: left;">
			<label style="margin-left: 250px;">FailureTip&nbsp;&nbsp;&nbsp;</label><br><input name="failureTip" data-options="multiline:true" class="easyui-textbox tbinput7" required="true" style="height:100px;width:555px;"/>
		</div>
	</form>-->
	<table id="tb">
		<thead>
		<tr>
			<th><label>版本</label></th>
			<th><input name="version" class="tbinput2" required="true" style=""/></th>
		</tr>
		<tr>
			<th>Watch版本</th>
			<th><input name="wVersion" class="tbinput1" required="true" style=""/></th>
		</tr>
		<tr>
			<th>ModifyDesc</th>
			<th><textarea name="modifyDesc" class="tbinput3" required="true" style="height:100px;"></textarea></th>
		</tr>
		<tr>
			<th>UpdateDesc</th>
			<th><textarea name="updateDesc" class="tbinput6" required="true" style="height:100px;"></textarea></th>
		</tr>
		<!--<tr>
			<th>UpdatePreTip</th>
			<th><textarea name="updatePreTip" class="tbinput5" style="height:100px;"></textarea></th>
		</tr>
		<tr>
			<th>UpdatingTip</th>
			<th><textarea name="updatingTip" class="tbinput4" style="height:100px;"></textarea></th>
		</tr>
		<tr>
			<th>FailureTip</th>
			<th><textarea name="failureTip" class="tbinput7" style="height:100px;"></textarea></th>
		</tr>-->
		</thead>
	</table>
</div>

<div id="dlg-buttons" style="height: 22px;">
	<div style="float: right">
		<a href="javascript:void(0)" class="easyui-linkbutton actionbtn" iconCls="icon-undo" plain="true" onclick="cancel()">取消</a>
	</div>
	<div class="datagrid-btn-separator" style="float: right"></div>
	<div class="datagrid-btn-separator" style="float: right"></div>
	<div style="float: right;">
		<a href="javascript:void(0)" class="easyui-linkbutton actionbtn" iconCls="icon-save" plain="true" onclick="save()">保存</a>
	</div>
</div>
<style type="text/css">
	#dlg {
		overflow: hidden;
	}

	#dlg th {
		border: 1px solid #2d2d2d;
		width: 400px;
		padding: 5px;
	}

	#tb input {
		width: 395px;
	}

	#tb textarea {
		width: 395px;
	}
</style>
<script>
	$('#dgUpdate').edatagrid({
		url: '/device/getUpdate',
		loader: datagridLoader,
		fit: true,
		toolbar: '#toolbar2',
		// pagination: true,
		// pageSize: 20,
		nowrap: false,
		onClickRow: function (index, row) {
			$('#dgUpdate').datagrid('options').queryParams = {
				id: row.id
			};
			$(".opbtn").linkbutton('enable');
		}
	});

	$(function () {
		$("#tb").children("thead").children("tr").children("th").children("input").focus(function () {
			$(this).css("box-shadow", "0px 0px 5px blue");
		});
		$("#tb").children("thead").children("tr").children("th").children("input").blur(function () {
			$(this).css("box-shadow", "none");
		});
		$("#tb").children("thead").children("tr").children("th").children("textarea").focus(function () {
			$(this).css("box-shadow", "0px 0px 5px blue");
		});
		$("#tb").children("thead").children("tr").children("th").children("textarea").blur(function () {
			$(this).css("box-shadow", "none");
		});
	});

	function edit() {
		var row = $("#dgUpdate").datagrid("getSelected");
		$("#tb").form("load", row);
		$("#dlg").dialog("open").dialog('setTitle', '编辑');
	}

	function insert() {
		$("#tb").children("thead").children("tr").children("th").children("input").val(null);
		$("#tb").children("thead").children("tr").children("th").children("input").css("box-shadow", "none");
		$("#tb").children("thead").children("tr").children("th").children("textarea").val(null);
		$("#tb").children("thead").children("tr").children("th").children("textarea").css("box-shadow", "none");

		$("#dlg").dialog("open").dialog('setTitle', '添加');
	}

	function deleteRow() {
		$.messager.confirm('确认', '确定删除吗？', function (confirm) {
			if (confirm) {
				var args = $('#dgUpdate').datagrid('options').queryParams;
				$.post("/device/removeUp", args, function () {
					$('#dgUpdate').datagrid("reload");
				});
			}
		});
	}

	function save() {
		var title = $(".panel-title").html();
		var args = {
			"version": $.trim($(".tbinput2").val()),
			"wVersion": $.trim($(".tbinput1").val()),
			"modifyDesc": $.trim($(".tbinput3").val()),
			"updateDesc": $.trim($(".tbinput6").val())
		};
		if (judge(args)) {
			args.updatePreTip = $.trim($(".tbinput5").val());
			args.updatingTip = $.trim($(".tbinput4").val());
			args.failureTip = $.trim($(".tbinput7").val());
			if (title == "编辑") {
				args.id = $('#dgUpdate').datagrid('options').queryParams.id;
				$.post("/device/updateUp", args, function (data) {
					if (data.errmsg != null)
						layerNoShadeAlert(data.errmsg);
					$('#dgUpdate').datagrid("reload");
				});
			} else {
				$.post("/device/saveUp", args, function (data) {
					if (data.errmsg != null)
						layerNoShadeAlert(data.errmsg);
					$('#dgUpdate').datagrid("reload");
				});
			}
			$("#dlg").dialog("close");
		}
	}

	function cancel() {
		$("#dlg").dialog("close");
	}

	function judge(args) {
		var temp = true;
		$.each(args, function (index, param) {
			if (param == null || param == "") {
				layer.msg('数据不能为空');
				temp = false;
			}
		});

		if (temp == false) {
			return false;
		}

		return temp;
	}
</script>